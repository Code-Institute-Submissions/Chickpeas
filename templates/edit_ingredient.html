<!-- Ajax Modal for the form for editing an igredient. Called from ingredients page. -->
<div class="modal-dialog modal-fluid" role="document">
  <div class="container modal-content">
    <div class="modal-header text-center">
      <h1 class="modal-title w-100 font-weight-bold">
        Edit Ingredient
      </h1>
      <button type="button" class="close custom-close" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <form
      id="ingredientForm"
      class="modal-body mx-3"
      action="{{ url_for('update_ingredient', ingredient_id=ingredient._id)}}"
      method="POST"
    >
      <div class="md-form mb-5">
        <input
          type="text"
          id="ingredient_name"
          name="name"
          class="form-control validate"
          required
          value="{{ingredient.name}}"          
          {% if session.username == 'Admin-T' %}
          {% elif session.username == ingredient.added_by %}
          {% else %}
          readonly
          {% endif %}
        />
        <label class="active" data-error="wrong" data-success="right" for="ingredient_name"
          >Ingredient Name</label
        >
      </div>
      <div class="md-form">
        <textarea
          id="ingredient_description"
          class="md-textarea form-control"
          name="description"
          required
          {% if session.username == 'Admin-T' %}
          {% elif session.username == ingredient.added_by %}
          {% else %}
          readonly
          {% endif %}
        >{{ingredient.description}}</textarea>
        <label class="active" for="ingredient_description">Ingredient Description</label>
      </div>
      <div class="md-form">
        <input
          type="text"
          class="form-control validate"
          id="more_info_link"
          name="more_info_link"
          placeholder="Add a link to more info on the ingredient. Wikipedia typically is a good option."
          value="{{ingredient.more_info_link}}"
          {% if session.username == 'Admin-T' %}
          {% elif session.username == ingredient.added_by %}
          {% else %}
          readonly
          {% endif %}          
        />
        <label class="active" for="more_info_link">More Info Link</label>
      </div>
      <h3>Common Substitutes</h3>
      <div class="md-form dropdown">
        <div id="edit-ingredient-dropdown" class="dropdown-content" style="display: block;">
            <input
              type="text"
              class="form-control"
              placeholder="...Write the ingredient name here(or part of it) to filter your selection in the list below..."
              id="edit-ingredient-dropdown-input"
              onkeyup="filterFunctionForEditIngredient()"
            />
            <select
              class="ingredient_select browser-default custom-select custom-select-lg"
              id="ingredient_select"
            >
              <option selected="true" disabled="disabled"
                >Choose Ingredient</option
              >
              {% for ing_name in ingredients %}
              <option>{{ing_name.name}}</option>
              {% endfor %}
            </select>
        </div>
      </div>

      <script>
        var ingredient_index = 1;
      </script>
      <div class="md-form">
        <input
          type="text"
          class="form-control validate"
          id="ingredient_comment"
        />
        <label for="ingredient_comment"
          >Comment(Tips for how to substitute)</label
        >
      </div>
      <div class="md-form">
        <button type="button" class="btn" onclick="addToIngredientList()">
          <i class="fas fa-plus-circle"></i>Add Substitute Ingredient
        </button>
      </div>
      <!--Script to reset the ingredient_index.
          Maybe possible to move script to a function with other scripts
          and call it at this point.------------------------------------->
	  <script>
	  var ingredient_index = 0 ;
	  </script>
	  <div class="md-form">
	    <ul class="list-group" id="sub_ingredient_list">
		{% for ingID, value in ingredient.items() %}
		{% if ingredient_search(ingID) in ingID %}{% set recname = ("name_"+ingID) %}
			<li type="text" readonly class="list-group-item {{ingID}}">
			</li>
            <!--Script here to utilize the jinja variables.-->
			<script>                                    
            $(document).ready(function () {
                        ingredient_index++;
                        $('.{{ingID}}').append(`<input type="text" class="form-control" readonly name='sub_ingredient_id_${ingredient_index}' value="{{value}}"><button type="button" onclick="removeLI()" class="btn float-right delete">Remove Ingredient</button><input type="text" hidden name="name_sub_ingredient_id_${ingredient_index}" value="{{ingredient[recname]}}">`)
						});
			</script>
		{% endif %}{% endfor %}
		</ul>
	  </div>
      <div>
        <div hidden>
          <input
            type="text"
            readonly
            id="added_by"
            name="added_by"
            value="{{ingredient.added_by}}"
          />
        </div>
      </div>
    </form>
    <div class="modal-footer md-form d-flex justify-content-center">
      <button type="submit" form="ingredientForm" class="btn btn-indigo">
        Update Ingredient
      </button>
    </div>
  </div>
</div>
<script>
  $(".custom-close").on("click", function () {
    $(".modal-backdrop").remove();
    $("#editIngredientModal").remove();
  });

    var selectedIngredient;
  $("select.ingredient_select").change(function () {
    selectedIngredient = $(this).children("option:selected").val();
  });
  function addToIngredientList() {
    if (!!selectedIngredient) {
      var commentlines = "";
      var ingredient_comment = $("#ingredient_comment").val();
      if (!!ingredient_comment) {
        commentlines = "---";
      } else {
        commentlines = "";
      }
      ingredient_index++;
      $("#sub_ingredient_list").append(
        `<li type="text" readonly class="list-group-item"><input type="text" class="form-control" readonly name="sub_ingredient_id_${ingredient_index}" value="${selectedIngredient} ${commentlines} ${ingredient_comment}"><button type="button" onclick="removeLI()" class="btn float-right delete">Remove Ingredient</button><input type="text" hidden name="name_sub_ingredient_id_${ingredient_index}" value="${selectedIngredient}"></li>`
      );
      
      clearAddIngredient();
    }
  }
  function clearAddIngredient() {
    $("#ingredient_select").prop("selectedIndex", 1).val();
    $("select.ingredient_select").val("selectedvalue").trigger("change");
    $("#ingredient_comment").val("");
  }
  function removeLI() {
    $(".delete").on("click", function () {
      $(this).parent().remove();
    });
  }

  function filterFunctionForEditIngredient() {
    var input, filter, ul, li, a, i, option;
    input = document.getElementById("edit-ingredient-dropdown-input");
    filter = input.value.toUpperCase();
    div = document.getElementById("edit-ingredient-dropdown");
    a = div.getElementsByTagName("option");
    for (i = 0; i < a.length; i++) {
      txtValue = a[i].textContent || a[i].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        a[i].style.display = "";
      } else {
        a[i].style.display = "none";
      }
    }
  };
</script>
