<div class="modal-dialog modal-fluid" role="document">
	<main class="container modal-content addRecipe">
		<!-- If createad by user, value="{{recipe.recipe_name}}"-->
		<div class="modal-header text-center">
			{% if recipe.added_by == session.username or recipe.edited_by == session.username %}
			<h1 class="modal-title w-100 font-weight-bold "><i class="fas fa-pencil-alt"></i> Update Recipe</h1>
			 <button
            type="button"
            class="close custom-close"        
            aria-label="Close"           
          >
            <span aria-hidden="true">&times;</span>
          </button>
		</div>
		<form id="updateForm" class="modal-body mx-3" action="{{ url_for('update_recipe', recipe_id=recipe._id) }}"
			method="POST">
			{% else %}
			<h1 class="modal-title w-100 font-weight-bold"><i class="far fa-copy"></i> Edit Your Copy</h1>
			 <button
            type="button"
            class="close custom-close"
                  
            aria-label="Close"
                        
          ><span aria-hidden="true">&times;</span>
            </button>
            
          </div>
			<form id="updateForm" class="modal-body mx-3" action="{{ url_for('insert_recipe', recipe_id=recipe._id) }}"
				method="POST">
				{% endif %}
				<!-- If created by user, value="{{recipe.recipe_name}}"-->
				<div class="md-form mb-5">
					<input
            type="text"
            class="form-control validate"
            id="recipe_name"
            name="recipe_name"
        {% if recipe.added_by == session.username or recipe.edited_by == session.username %}
            value="{{recipe.recipe_name}}"
		{% else %}
			
		{% endif %}
            required
            />
					<!-- If added or edited by user, same name.-->
					{% if recipe.added_by == session.username or recipe.edited_by == session.username %}
					<label class="active" data-error="wrong" data-success="right" for="recipe_name">Recipe Name</label>
					{% else %}
					<!-- If not added or edited by user , New name-->
					<label class="active" data-error="wrong" data-success="right" for="recipe_name">New Name for {{recipe.recipe_name}}</label>
					{% endif %}
				</div>
				<div class="md-form">
					<select
            id="meal_type"
            name="meal_type"
            class="browser-default custom-select custom-select-lg mb-3"
            >
        <option {% if recipe.meal_type == 'Breakfast' %} selected="true" {% endif %} >Breakfast</option>
        <option {% if recipe.meal_type == 'Lunch' %} selected="true" {% endif %} >Lunch</option>
        <option {% if recipe.meal_type == 'Dinner' %} selected="true" {% endif %} >Dinner</option>
        <option {% if recipe.meal_type == 'Dessert' %} selected="true" {% endif %} >Dessert</option>
            </select>
				</div>
				<div class="md-form">
					<textarea
                    class="md-textarea form-control"
            id="recipe_description"
            rows="3"
            name="recipe_description"
            maxlength="200"
            required
            >{{recipe.recipe_description}}</textarea>
					<label class="active" for="recipe_description">Recipe Description</label>
				</div>
				<h3>Recipe Image</h3>
				<div class="md-form">
					<input type="file" class="form-control-file" id="recipe_pic_url" disabled/>
        </div>
					<div class="md-form">
						<input
            type="text"
            class="form-control"
            id="recipe_image_link"
            name="recipe_pic_url"
            value="{{recipe.recipe_pic_url}}"
            />
        </div>
						<h3>Add Ingredients</h3>
      <div class="md-form">
        <div class="dropdown">
          <div id="myDropdown" class="dropdown-content" style="display: block;">
            <input
              type="text"
              class="form-control"
              placeholder="Write the ingredient name here to filter your selection."
              id="myInput"
              onkeyup="filterFunction()"
            />
            <select
              class="ingredient_select browser-default custom-select custom-select-lg"
              id="ingredient_select"
            >
              <option selected="true" disabled="disabled"
                >Choose Ingredient</option
              >
              {% for ing_name in ingredients %}
              <option>{{ing_name.name}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="text-right">
            Can't find your ingredient?
          </div>
        </div>
      </div>
						<div class="md-form">
							<input type="text" class="form-control validate" id="ingredient_measurement" />
							<label for="ingredient_measurement"
            >Measurement(ex. 200g, 1/2cup, 2dl)</label>
						</div>
						<div class="md-form">
							<input type="text" class="form-control validate" id="ingredient_comment" />
							<label for="ingredient_comment">Comment(ex. Use fresh.)</label>
						</div>
						<div class="md-form">
							<button type="button" class="btn" onclick="addToIngredientList()">
            <i class="fas fa-plus-circle"></i>Add Selected Ingredient
            </button>
						</div>
						<script>
							var ingredient_index = 0 ;
						</script>
						<div class="md-form">
							<ul class="list-group" id="recipe_ingredient_list">
								{% for ingID, ingredient in ingredients_selected.items() %}
								{% if ingredient_search(ingID) in ingID %}
								<li type="text" readonly class="list-group-item {{ingID}}">
								</li>
								<script>
									ingredient_index++;
                        $('.{{ingID}}').append(`<input type="text" class="form-control" readonly name='recipe_ingredient_id_${ingredient_index}' value="{{ingredient}}"><button type="button" onclick="removeLI()" class="btn float-right delete">Remove Ingredient</button>`)
						
								</script>
								{% endif %}{% endfor %}
							</ul>
						</div>
                        <h3>Recipe Instructions</h3>
						<div class="md-form">
							<textarea
                            class="md-textarea form-control"
            id="recipe_instructions"
            name="recipe_instructions"
            rows="6"
            required
            >{{recipe.recipe_instructions}}</textarea>
							<label class="active" for="recipe_instructions">Recipe Instructions</label>
						</div>
						<!-- Privacy Switch -->
						<div class="custom-control custom-switch">
							<input
              type="checkbox"
              class="custom-control-input"
              id="customSwitches"
              name="public"
            />
							<label class="custom-control-label" for="customSwitches"
              ><strong>Toggle this switch to make your recipe visable to the Public </strong><i class="fas fa-users"></i></label>
						</div>
						<div class="row">
							<div class="input-field" hidden>
								<input type="text" readonly id="edited_by" name="edited_by" value="{{session.username}}" />
								<label for="edited_by">Edited by:</label>
							</div>
						</div>                        
			</form>
			<div class="modal-footer md-form d-flex justify-content-center">

				<button type="submit" form="updateForm" class="btn btn-indigo">
            <!-- If creator, Update recipe-->
            {% if recipe.added_by == session.username or recipe.edited_by == session.username %}
            Update Recipe
            {% else %}
            Create Copy of Recipe
            {% endif %}
             <i class="fas fa-paper-plane-o ml-1"></i>
          </button>
			</div>
	</main>

</div>
<script>
	var selectedIngredient;
  $("select.ingredient_select").change(function () {
    selectedIngredient = $(this).children("option:selected").val();
  });
//   var ingredient_index ;
  function addToIngredientList() {
    if (!!selectedIngredient) {
      var ingredient_measurement = $("#ingredient_measurement").val();
      var commentlines = "";
      var ingredient_comment = $("#ingredient_comment").val();

      if (!!ingredient_comment) {
        commentlines = "---";
      } else {
        commentlines = "";
      }
       ingredient_index++;     
      $("#recipe_ingredient_list").append(
        `<li type="text" readonly class="list-group-item"><input type="text" class="form-control" readonly name="recipe_ingredient_id_${ingredient_index}" value="${ingredient_measurement} ${selectedIngredient} ${commentlines} ${ingredient_comment}"><button type="button" onclick="removeLI()" class="btn float-right delete">Remove Ingredient</button></li>`
      );
      
    }
  }
  function removeLI() {
    $(".delete").on("click", function () {
      $(this).parent().remove();
    //   ingredient_index--;
    });
  }
  /*-- For text area resizing --*/
  $('textarea').each(function () {
  this.setAttribute('style', 'height:' + (this.scrollHeight) + 'px;overflow-y:hidden;');
}).on('input', function () {
  this.style.height = 'auto';
  this.style.height = (this.scrollHeight) + 'px';
});

    $(".custom-close").on('click', function() {
        
         $('.modal-backdrop').remove();
         $('#ajaxModal').remove();
         console.log("custom-close")
        /* any changes will be lost*/       
    });
    
      function filterFunction() {
    var input, filter, ul, li, a, i, option;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    div = document.getElementById("myDropdown");
    a = div.getElementsByTagName("option");
    for (i = 0; i < a.length; i++) {
      txtValue = a[i].textContent || a[i].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        a[i].style.display = "";
      } else {
        a[i].style.display = "none";
      }
    }
  }
</script>