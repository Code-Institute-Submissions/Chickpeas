{% extends 'base.html'%} {% block content %}
<main class="container addRecipe">
    <!-- If createad by user, value="{{recipe.recipe_name}}"-->
    {% if recipe.added_by == session.username or recipe.edited_by == session.username %}
    <h1 class="center">Update Recipe</h1>
	<form action="{{ url_for('update_recipe', recipe_id=recipe._id) }}" method="POST">
    {% else %}
    <h1 class="center">Create a Copy</h1>
    <form action="{{ url_for('insert_recipe', recipe_id=recipe._id) }}" method="POST">
    {% endif %}
		<div class="input-field row">
            <!-- If created by user, value="{{recipe.recipe_name}}"-->
			<input
            type="text"
            class="form-control"
            id="recipe_name"
            name="recipe_name"
            {% if recipe.added_by == session.username or recipe.edited_by == session.username %}
            value="{{recipe.recipe_name}}"
            required
            />
            <!-- If added or edited by user, edit-->
			<label for="recipe_name">Recipe Name</label> 
            {% else %}           
            placeholder="Copy of {{recipe.recipe_name}}"
            required
            />
            <!-- If not added or edited by user , New name-->
			<label for="recipe_name">New Name for copied Recipe</label>                                     
            {% endif %}            
           
        </div>
		<div class="input-field row">
			<select
            id="meal_type"
            name="meal_type"
            >
        <option {% if recipe.meal_type == 'Breakfast' %} selected="true" {% endif %} >Breakfast</option>
        <option {% if recipe.meal_type == 'Lunch' %} selected="true" {% endif %} >Lunch</option>
        <option {% if recipe.meal_type == 'Dinner' %} selected="true" {% endif %} >Dinner</option>
        <option {% if recipe.meal_type == 'Dessert' %} selected="true" {% endif %} >Dessert</option>
            </select>
			<label class="active" for="meal_type" id="meal_label">Meal Category</label>            
		</div>
		<div class="input-field row">
			<textarea
            id="recipe_description"
            rows="4"
            name="recipe_description"
            >{{recipe.recipe_description}}</textarea>
			<label for="recipe_description">Recipe Description</label>            
		</div>
		<h3>Recipe Image</h3>
		<div class="input-field row">		
			<input type="file" class="form-control-file" id="recipe_pic_url" disabled/>
        </div>	    
		<div class="input-field row">
			<input
            type="text"
            class="form-control"
            id="recipe_image_link"
            name="recipe_pic_url"
            value="{{recipe.recipe_pic_url}}"
            />
        </div>
		<h3>Add Ingredients</h3>
		<div class="row input-field">
			<select class="ingredient_select" id="ingredient_select">
                <option selected="true" disabled="disabled">Choose Ingredient</option>
                {% for ing_name in ingredients %}
                <option>{{ing_name.name}}</option>
                {% endfor %}
            </select>
		</div>
		<div class="row input-field">
			<input type="text" id="ingredient_measurement" />
			<label for="ingredient_measurement"
            >Measurement(ex. 200g, 1/2cup, 2dl)</label>
		</div>
		<div class="row input-field">
			<input type="text" id="ingredient_comment" />
			<label for="ingredient_comment">Comment(ex. Use fresh.)</label>
        </div>
        <div class="row input-field">
		    <button type="button" class="btn" onclick="addToIngredientList()">
            <i class="fas fa-plus-circle"></i>Add Selected Ingredient
            </button>        
        </div>
        <script>
        var ingredient_index = 0 ;
        </script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
	integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>    
        <div class="row input-field">			
			<ul class="list-group form-group" id="recipe_ingredient_list">
				{% for ingID, ingredient in ingredients_selected.items() %}
				{% if ingredient_search(ingID) in ingID %}
				    <li type="text" readonly class="list-group-item {{ingID}}">					
					</li>
					<script>
                        ingredient_index++;
                        $('.{{ingID}}').append(`<input type="text" readonly name='recipe_ingredient_id_${ingredient_index}' value="{{ingredient}}"><button type="button" onclick="removeLI()" class="btn right delete">Remove Ingredient</button>`)
						
					</script>
				{% endif %}{% endfor %}
			</ul>
        </div>	
        <div class="row"></div>
		<div class="row input-field">			
			<textarea
            id="recipe_instructions"
            name="recipe_instructions"
            rows="12"
            >{{recipe.recipe_instructions}}</textarea>
            <label for="recipe_instructions">Recipe Instructions</label>
		</div>
        <div class="row">
            <div class="input-field" hidden>
                <input type="text" readonly id="edited_by" name="edited_by" value="{{session.username}}" />
                <label for="edited_by">Edited by:</label>
            </div>
        </div>
          <!-- Privacy Switch -->
        <div class="switch">
            <label>
            Private Recipe
            <input type="checkbox" name="public">
            <span class="lever"></span>
            Public Recipe
            </label>
        </div>
        <!-- If creator, Update recipe-->
		<div class="row center">
            {% if recipe.added_by == session.username or recipe.edited_by == session.username %}
			<button type="submit" class="btn btn-primary">
            Update Recipe
            </button>
            {% else %}
			<button type="submit" class="btn btn-primary">
            Create Copy of Recipe
            </button>
            {% endif %}
		</div>
	</form>
</main>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
	integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
	var selectedIngredient;
  $("select.ingredient_select").change(function () {
    selectedIngredient = $(this).children("option:selected").val();
  });
//   var ingredient_index ;
  function addToIngredientList() {
    if (!!selectedIngredient) {
      var ingredient_measurement = $("#ingredient_measurement").val();
      var commentlines = "";
      var ingredient_comment = $("#ingredient_comment").val();

      if (!!ingredient_comment) {
        commentlines = "---";
      } else {
        commentlines = "";
      }
       ingredient_index++;     
      $("#recipe_ingredient_list").append(
        `<li type="text" readonly class="list-group-item"><input type="text" readonly name="recipe_ingredient_id_${ingredient_index}" value="${ingredient_measurement} ${selectedIngredient} ${commentlines} ${ingredient_comment}"><button type="button" onclick="removeLI()" class="btn right delete">Remove Ingredient</button></li>`
      );
      
    }
  }
  function removeLI() {
    $(".delete").on("click", function () {
      $(this).parent().remove();
    //   ingredient_index--;
    });
  }
  /*-- For text area resizing --*/
  $('textarea').each(function () {
  this.setAttribute('style', 'height:' + (this.scrollHeight) + 'px;overflow-y:hidden;');
}).on('input', function () {
  this.style.height = 'auto';
  this.style.height = (this.scrollHeight) + 'px';
});
</script>
{% endblock %}