{% extends 'base.html'%}{% block content %}
<main class="container addRecipe mt-5 pt-5">
  <h1 class="center">Create Recipe</h1>
  <form action="{{ url_for('insert_recipe') }}" method="POST">
    <div class="row">
      <div class="input-field col s6">
        <input type="text" id="recipe_name" name="recipe_name" required />
        <label for="recipe_name">Recipe Name</label>
      </div>
    </div>
    <div class="input-field">
      <label class="active" for="meal_type">Meal Category</label>
      <select id="meal_type" name="meal_type">
        <option>Breakfast</option>
        <option>Lunch</option>
        <option>Dinner</option>
        <option>Dessert</option>
      </select>
    </div>
    <div class="input-field">
      <label for="recipe_description">Recipe Description</label>
      <textarea
        id="recipe_description"
        rows="3"
        name="recipe_description"
        required
      ></textarea>
    </div>
    <div>
      <h3>Recipe Image</h3>
    </div>
    <div class="input-field">
      <input
        type="file"
        class="form-control-file"
        id="recipe_pic_url"
        disabled
      />
    </div>
    <div class="input-field">
      <input type="text" id="recipe_image_link" name="recipe_pic_url" />
      <label for="recipe_image">Image Link</label>
    </div>
    <h3>Add Ingredients</h3>
    <div class="row input-field">
      <select class="ingredient_select" id="ingredient_select">
        <option selected="true" disabled="disabled"
          >Choose Ingredient</option
        >
        {% for ing_name in ingredients %}
        <option>{{ing_name.name}}</option>
        {% endfor %}
      </select>
    </div>
    <div class="row input-field">
      <input type="text" id="ingredient_measurement" />
      <label for="ingredient_measurement"
        >Measurement(ex. 200g, 1/2cup, 2dl)</label
      >
    </div>
    <script>
      var ingredient_index = 1;
    </script>
    <div class="row input-field">
      <input type="text" id="ingredient_comment" />
      <label for="ingredient_comment">Comment(ex. Use fresh.)</label>
      <button type="button" class="btn" onclick="addToIngredientList()">
        <i class="fas fa-plus-circle"></i>Add Selected Ingredient
      </button>
    </div>

    <ul class="list-group" id="recipe_ingredient_list">
      <li class="list-group-item"></li>
    </ul>
    <div class="row"></div>
    <div class="row input-field">
      <label for="recipe_instructions">Recipe Instructions</label>
      <textarea
        class="form-control"
        id="recipe_instructions"
        name="recipe_instructions"
        rows="3"
      ></textarea>
    </div>
    <div class="row">
      <div class="input-field" hidden>
        <input
          type="text"
          readonly
          id="added_by"
          name="added_by"
          value="{{session.username}}"
        />
        <label for="added_by">Added by:</label>
      </div>
    </div>
    <!-- Privacy Switch -->
    <div class="switch">
      <label>
        Private Recipe
        <input type="checkbox" name="public" />
        <span class="lever"></span>
        Public Recipe
      </label>
    </div>
    <div class="row center">
      <button type="submit" class="btn btn-primary">
        Submit Recipe
      </button>
    </div>
  </form>
</main>
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"
></script>
<script>
  var selectedIngredient;
  $("select.ingredient_select").change(function () {
    selectedIngredient = $(this).children("option:selected").val();
  });
  function addToIngredientList() {
    if (!!selectedIngredient) {
      var ingredient_measurement = $("#ingredient_measurement").val();
      var commentlines = "";
      var ingredient_comment = $("#ingredient_comment").val();
      if (!!ingredient_comment) {
        commentlines = "---";
      } else {
        commentlines = "";
      }
      $("#recipe_ingredient_list").append(
        `<li type="text" readonly class="list-group-item"><input type="text" readonly name="recipe_ingredient_id_${ingredient_index}" value="${ingredient_measurement} ${selectedIngredient} ${commentlines} ${ingredient_comment}"><button type="button" onclick="removeLI()" class="btn right delete">Remove Ingredient</button></li>`
      );
      ingredient_index++;
      clearAddIngredient();
    }
  }
  function clearAddIngredient() {
      $('#ingredient_select').prop("selectedIndex", 1).val();
      $('select.ingredient_select').val('selectedvalue').trigger('change');
      $('#ingredient_comment').val("");
      $('#ingredient_measurement').val("");

  }
  function removeLI() {
    $(".delete").on("click", function () {
      $(this).parent().remove();
    });
  }
</script>
{% endblock %}
