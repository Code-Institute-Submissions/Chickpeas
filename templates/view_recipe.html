{% extends "base.html" %}{% block content %}
<div class="mt-4 pt-5 pb-4">
<main class="container recipe-container pb-2 rounded shadow mt-5 pt-5 animated flipInY">
    <div class="row"> 
        <div class="col-12"> 
            <div><button class="btn float-left ml-5" onclick="goBack()">Back</button></div>
            {% if 'username' in session %}
            <div>            
            <a
              class="btn float-right mr-5"
              href="{{url_for('dashboard', username=session.username)}}"
              >{{session.username}}'s Cookbook</a
            ></div>
            {% endif %}
        </div>   
    </div>        
  <div class="row justify-content-center">    
    <div class="col-md-5 mt-4">
      {% if recipe.recipe_pic_url %}
      <img
        class="featurette-image img-responsive"
        src="{{ recipe.recipe_pic_url }}"
        alt="Picture of {{ recipe.recipe_name }}"
      />
      {% else %}
      <img
        class="featurette-image img-responsive"
        src="https://res.cloudinary.com/chickpeas/image/upload/v1591259691/chickpeas/variety-of-fruits_shgeju.jpg"
        alt="Default Pic"
      />
      {% endif %}
    </div>
  </div>
  <h1 class="row justify-content-center">{{recipe.recipe_name}}</h1>
  <div class="row justify-content-center">Course: {{recipe.meal_type}}</div>
  <div class="row justify-content-center">
    <p>{{recipe.recipe_description}}</p>
  </div>
  <div class="row justify-content-center">
    {% if 'username' in session %}
            <a
              href="{{url_for('edit_recipe', recipe_id=recipe._id)}}"
              data-remote="false"
              data-toggle="ajaxModal"
              class="btn"
              >
      {% if recipe.added_by == session.username or recipe.edited_by ==
      session.username %} Update
    </a>       
    <a
    onclick="return confirmDelete()"
    href="{{url_for('delete_recipe', recipe_id=recipe._id)}}"
    class="btn ml-1"
    >Delete
    </a>
      {% else %} 
      Create a Copy      
    </a>       
      {% endif %}
    {% endif %}
  </div>
  
  <div class="row ml-4">
  <div class="col-12">
    <ul class="" id="view_recipe_ingredient_list">
      
      {% for ingID, ingredient in ingredients_selected.items() %} {% if
      ingredient_search(ingID) in ingID %}{% set recname = ("name_"+ingID) %}
      <li><a
      href="{{url_for('view_ingredient2', ingredient_name=recipe[recname])}}"
              data-remote="false"
              data-toggle="ajaxModalIngredient"             
      ><i class="fas fa-leaf" style="color:green;"></i> {{ingredient}}</a></li>
      {% endif %}{% endfor %}
    </ul>
  </div>  
  </div>
  <h2 class="pl-5">Recipe Instructions</h2>
  <div class="row pl-5"><p class="pl-4">{{recipe.recipe_instructions}}</p></div>
</main>
</div>
{% endblock %}{% block js %}
<!-- Bootstrap js-->

<script>

  function confirmDelete() {
    if (confirm("Do you want to delete this recipe?") == false) {
      return false;
    } else {
      return true;
    }
  }

    $('[data-toggle="ajaxModal"]').on("click", function (e) {
    $("#ajaxModal").remove();
    e.preventDefault();
    var $this = $(this),
      $remote = $this.data("remote") || $this.attr("href"),
      $modal = $(
        '<div class="modal" id="ajaxModal"><div class="modal-body"></div></div>'
      );
    $("body").append($modal);
    $modal.modal({ backdrop: "static", keyboard: false });
    $modal.load($remote);
  });

    $('[data-toggle="ajaxModalIngredient"]').on("click", function (e) {
    $("#ajaxModalIngredient").remove();
    e.preventDefault();
    var $this = $(this),
      $remote = $this.data("remote") || $this.attr("href"),
      $modal = $(
        '<div class="modal" id="ajaxModalIngredient"><div class="modal-body"></div></div>'
      );
    $("body").append($modal);
    $modal.modal({ backdrop: "static", keyboard: false });
    $modal.load($remote);
  });

function goBack() {
  window.history.back();
}

</script>
{% endblock %}
