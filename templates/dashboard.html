{% extends 'base.html'%}{% block css %} {% endblock %} {% block content %}
<header class="container mt-5 pt-5">
  <h1 class="text-center pt-4">{{session.username}}'s Cookbook</h1>
  <p class="text-center">Welcome {{session.username}}, what's cooking?</p>
  <div class="text-center">
    <a
      href=""
      class="btn btn-default btn-rounded mb-4"
      data-toggle="modal"
      data-target="#modalSubscriptionForm"
      >Create a Recipe</a
    >
  </div>
</header>
<main>
  <h3 class="center">My Recipes</h3>
  <div class="container-fluid">
    <div class="row">
      <button class="btn mr-1 ml-2" onclick="listView()">
        <i class="fa fa-bars"></i>
      </button>
      <button class="btn" onclick="gridView()">
        <i class="fa fa-th-large"></i>
      </button>
    </div>
    {% for cat in my_recipes %} {% if loop.index % 2 != 0 %}
    <div class="row">
      {% endif %}
      <div class="row column featurette no-gutters shadow">
        <div class="col-md-5">
          {% if cat.recipe_pic_url %}
          <a href="{{url_for('view_recipe', recipe_id=cat._id)}}">
            <img
              class="featurette-image img-responsive"
              src="{{ cat.recipe_pic_url }}"
              alt="Picture of {{ cat.recipe_name }}"
            />
          </a>
          {% else %}
          <a href="{{url_for('view_recipe', recipe_id=cat._id)}}">
            <img
              class="featurette-image img-responsive"
              src="https://res.cloudinary.com/chickpeas/image/upload/v1591259691/chickpeas/variety-of-fruits_shgeju.jpg"
              alt="Default Pic"
            />
          </a>
          {% endif %}
        </div>
        <div class="col-md-7 pl-2">
          <h3 class=" col-md-9">
            <a href="{{url_for('view_recipe', recipe_id=cat._id)}}">
              {{ cat.recipe_name }}</a
            >
          </h3>
          <p class="pl-2 col-md-9 pb-2"><strong>{{ cat.recipe_description }}</strong></p>
          <div class="edit-delete-left pl-2">
            <a
              href="{{url_for('edit_recipe', recipe_id=cat._id)}}"
              class="btn edit-recipe"
              >Update</a
            >
            <a
              onclick="return confirmDelete()"
              href="{{url_for('delete_recipe', recipe_id=cat._id)}}"
              class="btn edit-recipe"
              >Delete</a
            >
          </div>
        </div>
      </div>
      {% if loop.index % 2 == 0 or loop.index == loop.length %}
    </div>
    {% endif %} {% endfor %}
  </div>
  <div
    class="modal fade"
    id="modalSubscriptionForm"
    tabindex="-1"
    role="dialog"
    aria-labelledby="myModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h4 class="modal-title w-100 font-weight-bold">
            <i class="fas fa-pencil-alt"></i>Create a Recipe
          </h4>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form
            id="addForm"
          class="modal-body mx-3"
          action="{{ url_for('insert_recipe') }}"
          method="POST"
        >
          <div class="md-form mb-5">
            <input
              type="text"
              id="recipe_name"
              name="recipe_name"
              class="form-control validate"
              required
            />
            <label data-error="wrong" data-success="right" for="recipe_name"
              >Recipe Name</label
            >
          </div>
          <div class="md-form">
            <select
              id="meal_type"
              class="browser-default custom-select custom-select-lg mb-3"
              name="meal_type"
            >
              <option value="" disabled selected>Choose the Meal Type</option>
              <option>Breakfast</option>
              <option>Lunch</option>
              <option>Dinner</option>
              <option>Dessert</option>
            </select>
          </div>
          <div class="md-form">
            <textarea
              id="recipe_description"
              class="md-textarea form-control"
              rows="3"
              name="recipe_description"
              maxlength="400"
              required
            ></textarea>
            <label for="recipe_description">Recipe Description</label>
          </div>
          <div>
            <h3 class="md-form">Recipe Image</h3>
          </div>
          <div class="md-form">
            <input
              type="file"
              class="form-control-file"
              id="recipe_pic_url"
              disabled
            />
          </div>
          <div class="md-form">
            <input
              type="text"
              class="form-control validate"
              id="recipe_image_link"
              name="recipe_pic_url"
            />
            <label for="recipe_image">Image Link</label>
          </div>
          <h3>Add Ingredients</h3>
          <div class="md-form">
            <select
              class="ingredient_select browser-default custom-select custom-select-lg mb-3"
              id="ingredient_select"
            >
              <option selected="true" disabled="disabled"
                >Choose Ingredient</option
              >
              {% for ing_name in ingredients %}
              <option>{{ing_name.name}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="md-form">
            <input
              type="text"
              class="form-control validate"
              id="ingredient_measurement"
            />
            <label for="ingredient_measurement"
              >Measurement(ex. 200g, 1/2cup, 2dl)</label
            >
          </div>
          <script>
            var ingredient_index = 1;
          </script>
          <div class="md-form">
            <input
              type="text"
              class="form-control validate"
              id="ingredient_comment"
            />
            <label for="ingredient_comment">Comment(ex. Use fresh.)</label>
          </div>
          <div class="md-form">
            <button type="button" class="btn" onclick="addToIngredientList()">
              <i class="fas fa-plus-circle"></i>Add Selected Ingredient
            </button>
          </div>
          <div class="md-form">
            <ul class="list-group" id="recipe_ingredient_list">
            </ul>
          </div>
          <div class="md-form">
            <label for="recipe_instructions">Recipe Instructions</label>
            <textarea
              id="recipe_instructions"
              class="md-textarea form-control"
              name="recipe_instructions"
              required
            ></textarea>
          </div>
          <div>
            <div class="input-group" hidden>
              <input
                type="text"
                readonly
                id="added_by"
                name="added_by"
                value="{{session.username}}"
              />
              <label for="added_by">Added by:</label>
            </div>
          </div>
          <!-- Privacy Switch -->
          <div class="custom-control custom-switch">
            <input
              type="checkbox"
              class="custom-control-input"
              id="customSwitches"
            />
            <label class="custom-control-label" for="customSwitches"
              >Toggle this switch to make your recipe visable to the
              Public</label
            >
          </div>
        </form>
        <div class="modal-footer md-form d-flex justify-content-center">
          <button type="submit" form="addForm" class="btn btn-indigo">
            Submit Recipe <i class="fas fa-paper-plane-o ml-1"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</main>
<!-- <div class="fixed-action-btn">
  <a class="btn-floating btn-large red" href="#"> ^</a>
</div> -->
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"
></script>
<script>
  $(document).ready(function () {
    $(".add-recipe").modal();
  });
  function confirmDelete() {
    if (confirm("Do you want to delete this recipe?") == false) {
      return false;
    } else {
      return true;
    }
  }

  // Get the elements with class="column"
  var elements = document.getElementsByClassName("column");

  // Declare a loop variable
  var i;

  // List View
  function listView() {
    for (i = 0; i < elements.length; i++) {
      elements[i].style.width = "100%";
    }
  }

  // Grid View
  function gridView() {
    for (i = 0; i < elements.length; i++) {
      elements[i].style.width = "50%";
    }
  }

  var selectedIngredient;
  $("select.ingredient_select").change(function () {
    selectedIngredient = $(this).children("option:selected").val();
  });
  function addToIngredientList() {
    if (!!selectedIngredient) {
      var ingredient_measurement = $("#ingredient_measurement").val();
      var commentlines = "";
      var ingredient_comment = $("#ingredient_comment").val();
      if (!!ingredient_comment) {
        commentlines = "---";
      } else {
        commentlines = "";
      }
      $("#recipe_ingredient_list").append(
        `<li type="text" readonly class="list-group-item"><input type="text" class="form-control" readonly name="recipe_ingredient_id_${ingredient_index}" value="${ingredient_measurement} ${selectedIngredient} ${commentlines} ${ingredient_comment}"><button type="button" onclick="removeLI()" class="btn float-right delete">Remove Ingredient</button></li>`
      );
      ingredient_index++;
      clearAddIngredient();
    }
  }
  function clearAddIngredient() {
      $('#ingredient_select').prop("selectedIndex", 1).val();
      $('select.ingredient_select').val('selectedvalue').trigger('change');
      $('#ingredient_comment').val("");
      $('#ingredient_measurement').val("");

  }
  function removeLI() {
    $(".delete").on("click", function () {
      $(this).parent().remove();
    });
  }
</script>

{% endblock %}
